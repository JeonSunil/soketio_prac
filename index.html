<!DOCTYPE html>
<html>
<head>
    <title>Gemini ì±—ë´‡ ì±„íŒ… (2ëª… ì •ì›)</title>
    <style>
        /* ğŸ’¡ CSS ìŠ¤íƒ€ì¼ ì‹œíŠ¸ ë¸”ë¡ ì¶”ê°€ */
        body { 
            margin: 0; 
            padding-bottom: 70px; /* ê³ ì • í•˜ë‹¨ í¼ ê³µê°„ í™•ë³´ */
            font-family: sans-serif; 
            background-color: #f7f7f7;
        }
        #messages { 
            margin: 0; 
            padding: 10px; 
            list-style-type: none; 
        }
        #messages li { 
            margin-bottom: 10px; 
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            line-height: 1.4;
        }
        .chat-message-time {
            color: gray; 
            font-size: 0.75em;
            margin-left: 5px;
        }
        /* ì±—ë´‡ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ ì •ì˜ */
        .chatbot-message {
            background-color: #e8eaf6; /* ì—°í•œ íŒŒë‘ ë°°ê²½ */
            border-left: 4px solid #3f51b5; /* ì§„í•œ íŒŒë‘ ë§‰ëŒ€ */
        }
        .chatbot-nickname {
            color: #3f51b5; /* ë‹‰ë„¤ì„ ìƒ‰ìƒ */
            font-weight: bold;
        }
        .user-nickname {
            font-weight: bold;
            color: #333;
        }
        #chat-form {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #ffffff;
            padding: 10px;
            box-sizing: border-box;
            border-top: 1px solid #ddd;
            display: flex;
        }
        #chat-input {
            flex-grow: 1;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #chat-form button {
            padding: 10px 15px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="user-count-area" style="text-align: center; font-weight: bold; padding: 10px; border-bottom: 1px solid #ccc; background-color: #fff;">
        ì ‘ì† ì¸ì›: <span id="user-count">0/2</span>
    </div>
    
    <div id="nickname-area" style="padding: 20px; text-align: center;">
        <form id="nickname-form">
            <input id="nickname-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" required style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;"/>
            <button style="padding: 8px 15px;">ì±„íŒ…ë°© ì…ì¥</button>
        </form>
    </div>

    <div id="chat-area" style="display: none;">
        <ul id="messages"></ul>
        <form id="chat-form">
            <input id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (@ì±—ë´‡ ë‚´ìš©)" autocomplete="off"/>
            <button>ì „ì†¡</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // HTML ìš”ì†Œ ì •ì˜ (ì´ì „ê³¼ ë™ì¼)
        const userCountDisplay = document.getElementById('user-count');
        const nicknameArea = document.getElementById('nickname-area');
        const nicknameForm = document.getElementById('nickname-form');
        const nicknameInput = document.getElementById('nickname-input');
        const chatArea = document.getElementById('chat-area');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const messages = document.getElementById('messages');

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // 1. ë‹‰ë„¤ì„ ì œì¶œ ì²˜ë¦¬ (ì´ì „ê³¼ ë™ì¼)
        nicknameForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const nickname = nicknameInput.value.trim();
            if (nickname) {
                socket.emit('new user', nickname, (response) => {
                    if (response.success) {
                        nicknameArea.style.display = 'none';
                        chatArea.style.display = 'block';
                        chatInput.focus();
                    } else {
                        alert(response.reason);
                    }
                });
            }
        });

        // 2. ì±„íŒ… ë©”ì‹œì§€ ì œì¶œ ì²˜ë¦¬ (ì´ì „ê³¼ ë™ì¼)
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (chatInput.value) {
                socket.emit('chat message', chatInput.value); 
                chatInput.value = '';
            }
        });

        // 3. ë©”ì‹œì§€ ìˆ˜ì‹  ë° í‘œì‹œ (ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ì ìš©)
        socket.on('chat message', (data) => {
            const timeString = formatTime(data.timestamp);
            const item = document.createElement('li');
            
            let nicknameClass = 'user-nickname';
            
            // ğŸš¨ ì±—ë´‡ ë©”ì‹œì§€ ì‹œê°ì  êµ¬ë¶„ (í´ë˜ìŠ¤ ê¸°ë°˜)
            if (data.nickname === 'Gemini ì±—ë´‡') {
                item.classList.add('chatbot-message');
                nicknameClass = 'chatbot-nickname';
            }
            
            item.innerHTML = `
                <span class="${nicknameClass}">${data.nickname}</span>
                <span class="chat-message-time">(${timeString})</span>
                <div>${data.text}</div>
            `;
            
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });

        // 4. ì‹œìŠ¤í…œ ì•Œë¦¼ (ì ‘ì†/í‡´ì¥) ìˆ˜ì‹  (ì´ì „ê³¼ ë™ì¼)
        socket.on('user notification', (message) => {
            const item = document.createElement('li');
            item.textContent = `[ì‹œìŠ¤í…œ] ${message}`; 
            item.style.color = 'gray';
            item.style.textAlign = 'center';
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });

        // 5. ì ‘ì†ì ìˆ˜ ì—…ë°ì´íŠ¸ ì²˜ë¦¬ (ì´ì „ê³¼ ë™ì¼)
        socket.on('update user count', (countString) => {
            userCountDisplay.textContent = countString; 
        });
    </script>
</body>
</html>