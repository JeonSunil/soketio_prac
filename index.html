<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Chat (2ëª… ì •ì›)</title>
</head>
<body>
    <div id="user-count-area" style="text-align: center; font-weight: bold; padding: 10px; border-bottom: 1px solid #ccc;">
        ì ‘ì† ì¸ì›: <span id="user-count">0/2</span>
    </div>
    
    <div id="nickname-area">
        <form id="nickname-form">
            <input id="nickname-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" required />
            <button>ì±„íŒ…ë°© ì…ì¥</button>
        </form>
    </div>

    <div id="chat-area" style="display: none;">
        <ul id="messages"></ul>
        <form id="chat-form">
            <input id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" />
            <button>ì „ì†¡</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
// index.html <script> íƒœê·¸ ë‚´ë¶€
const socket = io();

// HTML ìš”ì†Œ ì •ì˜
const userCountDisplay = document.getElementById('user-count'); // ìƒˆ ìš”ì†Œ
const nicknameArea = document.getElementById('nickname-area');
const nicknameForm = document.getElementById('nickname-form');
const nicknameInput = document.getElementById('nickname-input');
const chatArea = document.getElementById('chat-area');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const messages = document.getElementById('messages');

// 1. ë‹‰ë„¤ì„ ì œì¶œ ì²˜ë¦¬ (ì„œë²„ ì½œë°± ì²˜ë¦¬)
nicknameForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const nickname = nicknameInput.value.trim();
    if (nickname) {
        // ì„œë²„ì— ë‹‰ë„¤ì„ ì „ì†¡ ì‹œ ì‘ë‹µì„ ë°›ì„ ì½œë°± í•¨ìˆ˜ë¥¼ í•¨ê»˜ ì „ë‹¬
        socket.emit('new user', nickname, (response) => {
            if (response.success) {
                // âœ… ì„±ê³µ ì‹œ: í™”ë©´ ì „í™˜
                nicknameArea.style.display = 'none';
                chatArea.style.display = 'block';
            } else {
                // ğŸš¨ ì‹¤íŒ¨ ì‹œ: ì •ì› ì´ˆê³¼ ì•Œë¦¼ ë° ì ‘ì† ì°¨ë‹¨
                alert(response.reason); // "ì •ì›ì´ ë‹¤ ì°¼ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ
                // í™”ë©´ ì „í™˜ ì—†ì´ ë‹‰ë„¤ì„ ì…ë ¥ ì°½ ìœ ì§€
            }
        });
    }
});

// 2. ì±„íŒ… ë©”ì‹œì§€ ì œì¶œ ì²˜ë¦¬ (ì´ì „ê³¼ ë™ì¼)
chatForm.addEventListener('submit', (e) => {
    e.preventDefault();
    if (chatInput.value) {
        socket.emit('chat message', chatInput.value); 
        chatInput.value = '';
    }
});

socket.on('chat message', (data) => {
    const item = document.createElement('li');
    item.textContent = data; 
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
});

socket.on('user notification', (message) => {
    const item = document.createElement('li');
    item.textContent = `[ì‹œìŠ¤í…œ] ${message}`; 
    item.style.color = 'gray';
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
});

// 3. ì ‘ì†ì ìˆ˜ ì—…ë°ì´íŠ¸ ì²˜ë¦¬ (ì„œë²„ì—ì„œ ì „ì†¡ë°›ì€ ì •ë³´ë¥¼ ë°˜ì˜)
socket.on('update user count', (countString) => {
    userCountDisplay.textContent = countString; // ì˜ˆ: "0/2", "1/2", "2/2"
});

// ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì¶”ê°€ (ê°€ë…ì„±ì„ ìœ„í•´)
document.body.style.margin = '0';
messages.style.listStyleType = 'none';
messages.style.padding = '0 10px 50px 10px'; /* í¼ ê³µê°„ í™•ë³´ */
chatForm.style.position = 'fixed';
chatForm.style.bottom = '0';
chatForm.style.width = '100%';
chatForm.style.background = '#f1f1f1';
chatForm.style.padding = '10px';
chatInput.style.width = 'calc(100% - 70px)';
chatInput.style.padding = '8px';
chatInput.style.marginRight = '5px';
    </script>
</body>
</html>