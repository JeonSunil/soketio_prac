<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Chat</title>
    <style>
        /* CSS는 편의를 위해 생략합니다. */
    </style>
</head>
<body>
    <div id="nickname-area">
        <form id="nickname-form">
            <input id="nickname-input" placeholder="닉네임을 입력하세요" autocomplete="off" required />
            <button>채팅방 입장</button>
        </form>
    </div>

    <div id="chat-area" style="display: none;">
        <ul id="messages"></ul>
        <form id="chat-form">
            <input id="chat-input" placeholder="메시지를 입력하세요" autocomplete="off" />
            <button>전송</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ... (JavaScript 코드)
        const socket = io();

// HTML 요소 정의
const nicknameArea = document.getElementById('nickname-area');
const nicknameForm = document.getElementById('nickname-form');
const nicknameInput = document.getElementById('nickname-input');
const chatArea = document.getElementById('chat-area');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const messages = document.getElementById('messages');

// 1. 닉네임 제출 처리
nicknameForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const nickname = nicknameInput.value.trim();
    if (nickname) {
        // 서버에 'new user' 이벤트로 닉네임을 전송
        socket.emit('new user', nickname); 
        
        // 화면 전환: 닉네임 입력 영역 숨기기, 채팅 영역 표시
        nicknameArea.style.display = 'none';
        chatArea.style.display = 'block';
    }
});

// 2. 채팅 메시지 제출 처리 (변경 없음)
chatForm.addEventListener('submit', (e) => {
    e.preventDefault();
    if (chatInput.value) {
        // 서버로 메시지 전송
        socket.emit('chat message', chatInput.value); 
        chatInput.value = '';
    }
});

// 3. 서버로부터 메시지 수신 및 표시
// 서버가 닉네임이 포함된 메시지를 보내므로, 받은 데이터를 그대로 표시합니다.
socket.on('chat message', (data) => {
    const item = document.createElement('li');
    item.textContent = data; 
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
});

// 4. 시스템 알림 (접속/퇴장) 수신
socket.on('user notification', (message) => {
    const item = document.createElement('li');
    item.textContent = `[시스템] ${message}`; 
    item.style.color = 'gray'; // 시스템 메시지를 시각적으로 구분
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
});
    </script>
</body>
</html>