# soketio_prac
soketio_prac

## 사용한 스택
html
javascript
node.js
## 사용한 라이브러리
express
socket.io

# 진행상황
### 11/23
socket.io를 활용한 채팅앱 만들기 연습

1. ai를 활용해 먼저 바이브 코딩으로 채팅 기능 구현
  - 각기 다른 브라우저 페이지에서 채팅을 입력하면 다른 브라우저 페이지에서도 내용이 표출되며 갱신되는 것을 확인
  - 어떤 브라우저 페이지에서 어떤 채팅을 입력했는지 표시되면 좋겠다는 생각이 들었음.
2. 채팅 페이지에 접속하기 전 닉네임 입력 페이지 추가
  - 채팅 페이지 접속 전에 닉네임을 입력하게 만듦
  - 채팅 페이지 접속 후, 채팅을 입력하면 앞서 '입력한 닉네임  입력한 내용' 과 같이 표시 됨.
3. 구현 된 내용이 어떤 식으로 구동 되는지 원리를 파악 하기
  3-1. prac 브랜치를 따로 생성해서 해당 브랜치에서 하나하나 손으로 쳐보면서 코딩 해보기
    - 어떤 코드가 어떤 역할을 하는지, 어떤 의도로 활용되었는지, 대체제가 있는지를 파악하면서 확인해보는 중.


### 11/24
새로운 아이디어 (최대인원 설정, 채팅을 입력한 시간 표기)가 떠올라 바이브 코딩으로 기능 구현

1. 전날 작업한 기능 + 최대인원 설정 기능 구현
  - 최대인원을 설정하고, 최대인원을 초과하는 브라우저 페이지 접속자가 접속을 시도하면 alert 창으로 정원이 초과되었습니다 표시
  - 접속자 수를 페이지 상단에 표기

2. 채팅을 입력한 시간을 표시 기능 구현
  - 닉네임 우측에 괄호를 두고 해당 괄호 안에 채팅을 입력한 시간이 표시되도록 기능을 구현함.

  ### 11/25
  새로운 아이디어 (오픈ai를 활용해서 만일 @챗봇 이라고 치고, 채팅을 입력하면 챗봇이 대답해주는 기능을 추가 하고 싶음)

1. google Genai 를 활용해서 챗봇 구현하기
  - npm install google/genai 를 통해 google/genai 모듈 설치
  - 모듈 설치는 됐는데, apikey를 dotenv를 활용해서 .env파일에서 불러오려고 하는데, 잘 불러와 지지 않는듯
  - 서버를 키고, 확인을 해보니 계속해서 챗봇 오류 발생. 

  ### 11/26

1. google Genai 를 연동시키는데 계속해서 문제가 생김.
  - 우선 응답요청을 받아야할 듯.
  - node_modules와 package-lock.json 파일을 삭제하고, 새로 최신버전의 라이브러리를 새로 설치
  - nodejs와 genai가 버전호환이 문제일 수 있다는 가능성 파악 -> nvm을 설치해서 관리 해보는 방향으로 진행 예정
  - 기존 로컬 nodejs는 공식페이지에서 설치 파일을 다운받아 설치, -> 기존 nodejs를 삭제후, brew로 nvm을 설치 후, nvm으로 lts버전의 nodejs를 설치했음.
  - 교체 후에도 안됨.
  - 공식문서에서 ES6방식을 사용하고 있어 commonJS방식의 모듈 지정을 ES6방식으로 수정
  - 아직도 안 됨.
  - 공식문서와 작성코드를 비교 
    -> 작성코드는 ai.generateContent로 작성되었으나, 공식문서에는 ai에 models가 추가 된 ai.models.generateContent 로 표기되어있음. 해당 코드로 변경하고 실행할 예정
  - genai라이브러리가 googleCloud 인증정보를 찾을 수 없어서 문제가 발생 함을 확인
    -> 인증정보라는 내용을 토대로 apikey가 들어가지 않아서 인가? 라는 생각을 해봄.
    const ai = new GoogleGenAI({}); 이 변수를 const ai = new GoogleGenAI({ apiKey: apiKey }); 로 변경 
  - 실행이 되는 것을 확인.

  ### 11/27
  챗봇 응답대기 시간을 줄이거나, 로딩중 표시 예정

1. @챗봇 뒤의 첫번째 글자를 인식하지 못하는 현상 발견
  - const query = msg.substring(5).trim(); 부분이 5로 되어있어서 총 5글자가 제외되는데, @챗봇 띄어쓰기 이후 첫번째 글자까지가 5번째라 4로 변경 -> 문제 해결 확인
2. 챗봇 응답대기 시간을 줄일 수 있는 방안을 모색
  - 실제 ai도 내용을 파악하고, 생각을 하는 시간이 필요하기 때문에, 응답시간을 줄이기 보다 응답하는 중... 글자 표시할 생각
  - index.html파일에 script코드를 수정.
  - 응답대기중... 으로 계속 있으니 심심해서 .의 갯수가 늘어나고 줄어들고 하게 만들 생각
  - 완료
  - @챗봇을 includes로 조건을 둬서, 내용에 @챗봇 이라는 내용이 존재하기만 하면 응답대기중... 이 계속 표시되는 버그 발견
  - includes를 startsWith로 조건 변경
  - 버그 해결

  ### 11/28
  챗봇에 질문을 하고, 답변이 반환되지 않았는데, 다시 질문을 할 경우 응답대기중. 글자가 남아있는 버그 발견

  1. 해당 이슈에 대한 해결방안 모색
    - 이전 답변이 반환되기 전에는 입력 input을 disabled 속성을 추가하고, 답변이 완료되면 disabled속성을 삭제 하는 방안
      - 채팅과 챗봇을 같이 사용하는건데, 챗봇 내용이 나오기 전에 disabled를 하게 되면 챗봇 내용이 나오기 전에는 채팅기능도 사용하지 못하게 되는 것이 걸림.
      1-1
        - 일단 disabled 속성을 추가해 보았다
        - 챗봇을 호출한 브라우저가 아닌 다른 브라우저 환경에서는 응답대기중... 표시가 표출 되지 않고, 다른 브라우저 환경에서는 disabled 속성이 추가 되지 않음을 확인
        - 당연하다. 프론트에 해당 로직이 있으니까 전체에게 적용되지 않지.
        - 그러면 해당 요소를 추가하고 변경하고, disabled 속성을 부여하는 것을 프론트 측이 아니라 백 측에서 한다면?

  ### 11/30
  접속하지도 않았는데, 채팅 내용이 남아있는 버그 발견 

  1. 해당 이슈가 일어나는 이유를 모색
   - 이는 클라이언트가 소켓 연결을 맺었을 때, 닉네임을 등록하기 전에 이미 기존에 화면에 그려져 있던 채팅 내용이 남아 있기 때문에 발생
   - 가장 확실한 해결책은 클라이언트 측 JavaScript에서 소켓이 연결되자마자(socket.on('connect')), 채팅 메시지 영역의 내용을 무조건 초기화하는 것
  - 위의 내용을 반영해서 코드를 수정
  - (닉네임)님이 접속하였습니다 문구가 직접 접속한 유저에게는 표시되지 않는 버그 발생.
  - 기존의 접속 문구 표시는 서버 측에서 새로운 유저가 들어왔다는 알림에 의존해서 messages.innerHTML = ''; 코드가 알림을 받은 이후에 실행되기 때문에 접속문구가 표출되지 않았던 것. 그래서 실행 순서를 변경해서 messages.innerHTML = ''; 코드가 실행된 이후에 접속 문구를 표시 하게 만들면 될 듯.
  - 문제가 해결됨을 확인

  ### 12/1
  trpg를 만들기 위해서, 닉네임을 입력하고 입장하는 형태에서 방 만들기 후 닉네임 입력 및 및 메인 화면에서 방에 입장후 닉네임 입력하는 형태로 채팅을 변경 해보기.
  - 아래의 프롬프트로 ai를 활용한 바이브 코딩 진행
    - 닉네임만 입력하고 입장하면 입장되는 형태에서 메인 화면 하단에 방만들기 버튼을 만들고, 해당 방만들기 버튼을 클릭하면 방 이름, 정원(최소 2명, 최대 4명), 비밀번호 사용 및 사용안함 체크박스 및 비밀번호 입력 input창(체크박스 클릭시 input창이 활성화 체크박스 해제시 input창이 disabled)에 를 입력할 수 있게 만들고, 방이 만들어 지면 방을 만든 유저는 해당 채팅 창에 들어가고, 다른 유저가 메인화면에 접속시 해당 방의 이름이 담긴 요소가 표시되고, 해당 요소를 클릭 시 방에 비밀번호가 있다면 비밀번호를 입력하는 창이 나오고, 맞는 비밀번호 입력시 방에 입장, 모든 유저는 방에 입장 시 해당 방에서 사용할 닉네임 입력 input창이 먼저 나오고 닉네임을 입력 시 채팅창에 입장

  - 방을 만든 유저도 비밀번호 및 닉네임을 입력해야하는 문제 발생.
  - 방만들기를 했음에도 방이 존재하지 않습니다. 문구가 표시되고 들어가지 못하는 문제 발생.
  - 방입장이 안되는 버그 수정
  - 방입장 -> 비밀번호 및 닉네임 입력 -> 입장 의 형태에서 
    방입장 -> 비밀번호 입력 -> 비밀번호가 맞으면 닉네임 입력 -> 채팅창 진입의 형태로 수정.


  ### 12/2
  현재 상황에서 게임시작 버튼 및 게임준비 버튼 생성
  - 방을 만든 유저는 방장이 되고, 방장은 게임시작 버튼(입장한 모든 인원이 게임준비 버튼을 눌렀을 때 활성화)
  - 방에 입장한 유저는 게임준비 버튼이 표시된다.
  - 게임이 시작이 되면 다른 채팅창으로 이동.

  - 방장 권한, 게임시작 및 게임준비 버튼 추가, 게임시작 버튼 클릭시 최소2명, 모든 인원이 준비를 해야한다 문구 표시 완료
  - 방장 권한 넘기기 기능 및, 현재 게임 준비를 해도 게임시작이 안되는 문제 해결 예정
  - 게임시작시 방장부터 차례를 부여받고, 자기차례에 텍스트를 입력할 수 있는 input창이 생성되도록 만들예정.

  - 방장권한 위임 기능, 접속유저 목록 표시, 게임준비 및 게임시작 버튼, 게임준비시 준비 표시 까지 구현완료
  - 채팅을 입력 후 엔터를 누르면 채팅이 전송되는 것이 아닌 게임시작버튼을 클릭 하는 것으로 적용되는 버그 발견
  - 게임준비시 버튼 색깔 변경 및 게임준비라는 문구를 준비 취소 라는 문구로 변경할 것.

  - 채팅을 입력 후 엔터를 누르면 채팅이 전송되는 것이 아닌 게임시작버튼을 클릭 하는 것으로 적용되는 버그 수정

  ### 12/3
  하루에 조금이라도 코딩하려고 노트북을 킴.
  - 게임준비시 버튼 색깔 변경 및 게임준비라는 문구를 준비 취소 라는 문구로 변경하기를 목표로 함.
  - <style>과 <script>의 gameReadyBtn의 이벤트에 조건을 추가해서 문구가 변경되고, 색깔이 변경되도록 만듦.
  - 구현 확인 
  - 혹시 어떤 버그가 있는지 내일 확인 해볼 예정.
  


